<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="css/reset.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
  <script src="./js/app.js"></script>
  <title>자금관리</title>
  <script>
      $(document).ready(function(){
        var id;
        var list = [];
        var v;

        //get 방식으로 url 데이터받기
         if(location.search != ""){              //url가져옴
            //console.log(location.search);
              var param = location.search.replace("?",""); // ?뒤로자름
             //console.log(param);
             var params = param.split("&");
             //console.log(params);
             var row = {};
             for(var i = 0; i < params.length; i++){
                 var map = params[i].split("=");
                 row[map[0]] = decodeURI(map[1]);
             }
             //console.log(row);

              if(localStorage.getItem("list")==null) {
              console.log("데이터없음");
             } else {
                list=JSON.parse(localStorage.getItem("list"));
             }


             list[list.length] = row;
             localStorage.setItem("list", JSON.stringify(list));
             location.search = "";
            /* $.ajax({
               url:"/m3/index.json",
               dataType : "json",
              method : "POST",
               data: {json :  JSON.stringify(list)},

             }).done(function(data){
               data.no="1";
               console.log(data.no);
             }).fail(function(data,b,c){
               data.no=2;
               console.log(data,b,c);
             });*/

         }

        //화면에 뿌려주기

          if(location.hash.length>=4) {
              console.log(location.hash);
            var url=location.hash.substring(location.hash.indexOf('?')+1, location.hash.length );
            //console.log(url);
            location.hash="#c2";   //문제
            $(id).css("display","none");
            id = location.hash;//$(this).attr("href");
            $(id).css("display","block");

            //var param = location.search.replace("?",""); // ?뒤로자름
            //console.log(param);
            var params = url.split("&");
            //console.log(params);
            var row = {};

            for(var i = 0; i < params.length; i++){

                var map = params[i].split("=");
                            //console.log(i);
                $("#c2 input").eq(i).val(decodeURI(map[1]));
            }
          };
            //console.log(location.hash);
        //location.hash="#c1";
        $("#c0").hide();
        if(location.hash=="") {
          $("#c0").show();
        }else {
          $("#c0").hide();
        }


        v="<div class=\"s1\"><form action=\"index.html#c1\">"+
        "날짜 범위 <input name=\"date\" type=\"date\" style=\"width: 200px; height:30px\">"+
        "<input type=\"date\" placeholder=\"날짜검색\" style=\"width: 200px; height:30px\">"+
        "<input type=\"button\" value=\"검색\" style=\"width: 100px; height:30px\"></form></div>";

        v+="<table><tr><td>구분</td><td>발생기간</td><td>금액</td><td>항목</td><td>거래처</td><td>실적</td><td>수정</td><td>삭제</td></tr>";
        if(localStorage.getItem("list") !=null) {
        var v1=JSON.parse(localStorage.getItem("list"));
        //console.log(v1.length);
        //console.log(localStorage.getItem("list"));
        for(var i=0;i<v1.length;i++) {
          /*var modify="<a href=\"index.html#c2?no="+v1[v3]["no"]+"&contents="+
          v1[v3]["contents"]+"&i="+v3+"\""+" id=\"b\" onclick=\"chk()\";>"+
          "수정"+"</a></div>";*/
          //v1[i]["no"]   $("input[name='no']:checked").val()   $("label[for='"+radioId+"']").text();
//          var v11=$("label[for='"+radioId+"']").text()
//          console.log($("label[for='"+radioId+"']").text());
          var v5="index.html#c2?"+"no="+v1[i]["no"]+"&time="+v1[i]["time"]+"&money="+
          v1[i]["money"]+"&content="+v1[i]["content"]+"&target="+v1[i]["target"]+"&result="+v1[i]["result"];

            //v3=list[i]["#title"];
            v+="<tr><td>"+v1[i]["no"]+"</td><td>"+v1[i]["time"]+"</td><td>"+
            v1[i]["money"]+"</td><td>"+v1[i]["content"]+"</td><td>"+v1[i]["target"]+
            "</td><td>"+v1[i]["result"]+
            "</td><td><a href="+v5+"><button type=\"button\" class=\"btn\">수정</a></td>"+
            "<td><button id=\"cb\" type=\"button\" class=\"btn33\">삭제</td></tr>";
            //"<input id=\"cb2\" type=\"checkbox\" name=\"chk_info\" value=\"del\">";
            //console.log(v);
        }
      }
        $("#c1").html(function(i,origtext){
            v+="</table>"
            return v;
        });
        id=location.hash;
        $(id).css("display","none");
        $(location.hash).css("display","block");
        $(location.hash).html();


        $(window).on("popstate", function(e) {
          if(location.hash.length < 4 ) {
            //console.log(location.hash);
            $(id).css("display","none");
            id = location.hash;//$(this).attr("href");
            $(id).css("display","block");
            $(location.hash).html();
            $("#c0").hide();
            if(location.hash=="") {
              $("#c0").show();
            }
          }else {
            console.log(location.hash);
            var url=location.hash.substring(location.hash.indexOf('?')+1, location.hash.length );
            //console.log(url);
            location.hash="#c2";
            $(id).css("display","none");
            id = location.hash;//$(this).attr("href");
            $(id).css("display","block");

            //var param = location.search.replace("?",""); // ?뒤로자름
            //console.log(param);
            var params = url.split("&");
            //console.log(params);
            var row = {};
            for(var i = 0; i < 2; i++){
              if($("#c2 input").eq(i).val()=="입금") {
                $("#c2 input").eq(i).checked;
              }else {
                $("#c2 input").eq(i).checked;
              }
            }
            for(var i = 2; i < params.length+1; i++){

                var map = params[i-1].split("=");
                $("#c2 input").eq(0).val(decodeURI(map[1]));
                $("#c2 input").eq(i).val(decodeURI(map[1]));
                //console.log($("#c2 input").eq(i).val(decodeURI(map[1])));
            }
          }
        });

        //var url = $(this).attr("url");
        //메뉴 클릭시 효과


         $("nav li").click(function(e){
              //var url = $(this).attr("url");
             //history.replaceState(null, null, location.hash);
             $("nav li").css("backgroundColor","#94b0b9");
             //$("#c2").css("backgroundColor","#00aaaa");
             //$("#c3").css("backgroundColor","#00aaaa");
               $(this).css("backgroundColor", "#84a0b9");
             e.preventDefault();
             location.hash = $(this).children("a").attr("href");
             $(id).css("display","none");
             id = location.hash;//$(this).attr("href");
             $(id).css("display","block");
             $(location.hash).html();
              //첫번재 출력했을 때
              if($("li").index(this)==0) {
                  var v1=JSON.parse(localStorage.getItem("list"));

                  /*function goPage(no,time,money,content,target, result) {
                   // name이 paging인 태그
                   var f = document.paging;

                   // form 태그의 하위 태그 값 매개 변수로 대입
                   $("#c2").attr("no").val(no);

                   f.cate.value = cate;
                   f.index.value = index;

                   // input태그의 값들을 전송하는 주소
                   f.action = "./index#c2"

                   // 전송 방식 : post
                   f.method = "post"
                   f.submit();
                  };
                  */
                  var v3;


                  v="<div class=\"s1\"><form action=\"index.html#c1\">"+
                  "날짜 범위 <input name=\"date\" type=\"date\" style=\"width: 200px; height:30px\">"+
                  "<input type=\"date\" placeholder=\"날짜검색\" style=\"width: 200px; height:30px\">"+
                  "<input type=\"button\" value=\"검색\" style=\"width: 100px; height:30px\"></form></div>";

                  v+="<table><tr><td>구분</td><td>발생기간</td><td>금액</td><td>항목</td><td>거래처</td><td>실적</td><td>수정</td><td>삭제</td></tr>"

                  if(v1==null) return;
                  for(var i=0;i<v1.length;i++) {
                    /*var modify="<a href=\"index.html#c2?no="+v1[v3]["no"]+"&contents="+
                    v1[v3]["contents"]+"&i="+v3+"\""+" id=\"b\" onclick=\"chk()\";>"+
                    "수정"+"</a></div>";*/
                    //v1[i]["no"]   $("input[name='no']:checked").val()   $("label[for='"+radioId+"']").text();



                    var v5="index.html#c2?"+"no="+v1[i]["no"]+"&time="+v1[i]["time"]+"&money="+
                    v1[i]["money"]+"&content="+v1[i]["content"]+"&target="+v1[i]["target"]+"&result="+v1[i]["result"];
                    var radioVal = $('input[name="no"]:checked').val();

                      //v3=list[i]["#title"];
                      v+="<tr><td>"+v1[i]["no"]+"</td><td>"+v1[i]["time"]+"</td><td>"+
                      v1[i]["money"]+"</td><td>"+v1[i]["content"]+"</td><td>"+v1[i]["target"]+
                      "</td><td>"+v1[i]["result"]+
                      "</td><td><a href="+v5+"><button type=\"button\" class=\"btn\">수정</a></td>"+
                      "<td><button id=\"cb\" type=\"button\" class=\"btn33\">삭제</td></tr>";
                      //"<input id=\"cb2\" type=\"checkbox\" name=\"chk_info\" value=\"del\">";
                      //console.log(v);
                  }

                  $("#c1").html(function(i,origtext){
                      v+="</table>"
                      return v;
                  });
                  v+="</table>"

              }
              //두번째출력했을 때
             if($("li").index(this)==1) {
               //console.log($("p").index().val());
              /* $.ajax({
                 url:"/m3/index.json"
                 , dataType : 'html',
                 type : 'GET',
                 data: {no:"1"}
               }).done(function(data){
                 data.no=1;
                 console.log(data.no);
               }).fail(function(data,b,c){
                 data.no=2;
                 console.log(data.no,b,c);
               });*/
             }
         });

         //수정 눌렀을 때
         /*$("#c2").on("click","button",(function(e){

              var v1=JSON.parse(localStorage.getItem("list"));
              var html="";
              var v="";

              for(var i=0; i<v1.length;i++) {
                  if(v1[i]["title"] ==  $(this).text()) {
                      v3=i;
                  }
                  //console.log("<p>"+v1[i]["title"]+"</p>" , $(this).text());
              }
              var v4=v1[v3]["title"];
              v=v1[v3]["contents"];
              $(".contents").html(function(i,origtext){
                  return v;
              });
             //console.log(v3);
             /*function goPage(no, time, index,) {
              // name이 paging인 태그
              var f = document.paging;

              // form 태그의 하위 태그 값 매개 변수로 대입
              f.content.value = content;
              f.cate.value = cate;
              f.index.value = index;

              // input태그의 값들을 전송하는 주소
              f.action = "./content.do"

              // 전송 방식 : post
              f.method = "post"
              f.submit();
            };
              var v5="<div id=\"d\" style=\"display:block; width:100%; height:100px; \" ><a href=\"index#c2\" id=\"btn\" onclick=\"chk()\";>"+"수정"+"</a></div>";

              //console.log(v5);
              $(".contents").html(function(i,origtext){
                  return v+=v5;
              });

          }));*/
          //수정2
          $("#c1").on("click","#btn",(function(e){

            //var v5;
            //list=JSON.parse(localStorage.getItem("list"));

            //index = $("#btn").index(this);

            //console.log(Math.abs(index));
/*
            list.splice(index,1);
            localStorage.setItem("list",JSON.stringify(list));

            var v1=JSON.parse(localStorage.getItem("list"));var v="";
            var v3;
            console.log(v1.length);
            if(v1.length==0) {
                $(".contents").html("");return;
            }
            for(var i=0;i<v1.length;i++) {
                //v3=list[i]["#title"];
                v+="<div style=\"display:inline-block width: 100%\"><input id=\"cb\" type=\"checkbox\" name=\"chk_info\" value=\"del\"></div><p>"+v1[i]["title"]+"</p>";
               // console.log(v);
                $(".contents").html(function(i,origtext){
                    return v;
                });
            }*/
          }));
          //저장

          //수정취소
          $("#c2").on("click","#cancel",(function(e){
            location.href="#c1";
          }));

          //삭제

        $("#c1").on("click","#cb",(function(e){
          console.log("삭제");
           var v5;
           list=JSON.parse(localStorage.getItem("list"));
           var c1=$("#c1").html();

           var index = $("#cb").index(this);

           //console.log(Math.abs(index));

           list.splice(index,1);
           localStorage.setItem("list",JSON.stringify(list));

           var v1=JSON.parse(localStorage.getItem("list"));var v="";
           v="<div class=\"s1\"><form action=\"index.html#c1\">"+
           "<input type=\"date\" placeholder=\"날짜검색\" style=\"width: 200px; height:30px\">"+
           "<input type=\"button\" value=\"검색\" style=\"width: 100px; height:30px\"></form></div>";

          v+="<table><tr><td>구분</td><td>발생기간</td><td>금액</td><td>항목</td><td>거래처</td><td>실적</td><td>수정</td><td>삭제</td></tr>";
           var v3;
           console.log(v1.length);

           if(v1.length==0) {
               $("#c1").html(v);return;
           }
           for(var i=0;i<v1.length;i++) {
               //v3=list[i]["#title"];

                 v+="<tr><td>"+v1[i]["no"]+"</td><td>"+v1[i]["time"]+"</td><td>"+
                 v1[i]["money"]+"</td><td>"+v1[i]["content"]+"</td><td>"+v1[i]["target"]+
                 "</td><td>"+v1[i]["result"]+
                 "</td><td><a href=\"index.html#c2\"><button type=\"button\" class=\"btn\">수정</a></td>"+
                 "<td><button id=\"cb\" type=\"button\" class=\"btn"+i+"\">삭제</td></tr>";
                 //console.log(v);
               }
               $("#s1").show();
               $("#c1").html(function(i,origtext){
                   v+="</table>"
                   return v;
               });
               v+="</table>"


             }));

         $("form").submit(function(){
            //location.reload();
         });
         $("nav ul").click(function(){
           var width=$(window).width();
         //var mql = window.matchMedia("screen and (max-width: 700px)");
         //mql.addListener(function(e) {
         //console.log(width);
           if(width <= "576") {
             $("#menu").toggle();
             //$("li").css("display","block");
             $("nav li").attr("height","200px");
             $("nav li").attr("backgroundColor","#94b0b9;");
             console.log("click");
           }
         //})
        });

          $("#menu").show();

      //메뉴1 팝업
      var colnm=8;
      var idx;
      var idx2;
        $("#c1 ").on("click","table tr",(function(e){

          //var idx=($("tr").index(this)-1)*colnm;
          idx=($("tr").index(this))*colnm;
          //console.log( $("td").index("td"));
        //  console.log($("tr").index("tr"));
        //console.log(idx);
        if(8 <= idx2 && idx2 < idx+(colnm-2) ) {
          //console.log( $("td").index(this));
          //Wconsole.log(idx2, idx+(colnm-2));
      //  window.open("index3.html");
        var c1= "<ul><li>구분:<input name=\"no\" type=\"radio\" value=\"입금\" placeholder=\"구분\" style=\"\">입금"+
                "<input name=\"no\" type=\"radio\" value=\"출금\" placeholder=\"구분\" style=\"\">출금</li>"+
                "<li>발생기간: <input name=\"time\" type=\"date\" placeholder=\"구분\" style=\"width:40%; height:20px\"></li></ul>"+
                "<ul><li>금액&nbsp;&nbsp;&nbsp;: <input name=\"money\" type=\"text\" placeholder=\"구분\" style=\"width:50%; height:20px\"></li>"+
                "<li>종목: <input name=\"content\" type=\"text\" placeholder=\"구분\" style=\"width:50%; height:20px\"></li></ul>"+
                "<ul><li>거래처: <input name=\"target\" type=\"text\" placeholder=\"구분\" style=\"width:50%; height:20px\"></li>"+
                "<li>실적: <input name=\"result\" type=\"text\" placeholder=\"구분\" style=\"width:50%; height:20px\"></li></ul>"+
                "<p>상세내용 : <input name=\"contents\" type=\"text\" placeholder=\"구분\" style=\"width:calc(80%); height:200px\"></p>"+
                "<ul class=\"i2\"><input  id= \"store\" type=\"submit\"  style=\"width: 60px; height:30px\" >"+
                "<input name=\"취소\" id=\"cancel\" type=\"button\" value=\"취소\" style=\"width: 60px; height : 30px\"><ul>";

      $(".popup2").empty().append(c1);

      var data1=JSON.parse(localStorage.getItem("list"));

      console.log(data1[$("tr").index(this)-1]["time"]);
      popup();
      }
      }));
        $("#c1 ").on("click","td",(function(e){
        //var idx=($("tr").index(this)-1)*colnm;
          //idx=($("tr").index(this)-1)*colnm;
        //console.log( $("td").index(this));
      //  console.log($("tr").index("tr"));

            //console.log( $("td").index(this));
            //console.log(idx+(colnm-2));
            idx2=$("td").index(this);

        }));
        function popup() {
          $(".popup").css("display","block");
        }
        if($(".popup").on("click","#cancel",function(){
              $(".popup").css("display","none");
        }));
        //$('td:nth-child(7)').hide();
        //$('td:nth-child(8)').hide();
      });
  </script>
</head>
<body>
  <div class="m1">
      <h2 style="text-align : center;">자금/예산관리 프로그램</h2>
    <div class="m2">
    <a href="index.html"><h3>자금관리</h3></a>
    </div>
    <div class="m2">
    <a href="index2.html"><h3>예산관리</h3></a>
    </div>
  </div>
  <nav>
    <ul id="menu2">메뉴</ul>
    <ul id="menu">
      <!--<li url="index1_1.html">자금계획관리</a></li><br>
      <li url="index1_2.html">자금계획등록</a></li><br>
      <li url="index1_3.html">월별자금변동</a></li>
      <li><a href="index1_1.html">자금계획관리</a></li><br>
      <li><a href="index1_2.html">자금계획등록</a></li><br>
      <li><a href="index1_3.html">월별자금변동</a></li>-->
      <li><a href="#c1">자금계획관리</a></li>
      <li><a href="#c2">자금계획등록</a></li>
      <li><a href="#c3">월별자금변동</a></li>
    </ul>
  </nav>
  <section id="c0">
    <article>
      안녕하세요 봉준의 회계 관리 프로그램입니다.
      <img src="./img/main.jpg" width= "100%"; height= "600px"; >
    </article>
  </section>
  <div class="popup">

    <div class="popup2">
    </div>
  </div>
  <section id="c1">
    <div class="s1">
    <form action="index.html#c1">
    날짜 범위<input class="s2" name="date" type="date" style="width:200px; height:30px;">
    <input class="s2" name="date" type="date" style="width: 200px; height:30px">
    <input class="s3" type="button" value="검색" style="width: 100px; height:30px">
    </form>
    </div>
    <table id="page1">
      <thead>
      <tr>
        <th>구분</th>
        <th>발생기간</th>
        <th>금액</th>
        <th>항목</th>
        <th>거래처</th>
        <th>실적</th>
        <th class="t1">수정</th>
        <th class="t1">삭제</th>
      </tr>
      </thead>
    </table>
  </section>
  <section id="c2">
    <div class="i1">
      <form action="index.html#c1">
<!--        <p>구분&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <input name="no" type="radio" value="입금" placeholder="구분" style="width:50px; height:20px">입금
        <input name="no" type="radio" value="출금" placeholder="구분" style="width:50px; height:20px">출금<p>
        <p>발생기간&nbsp;: <input name="time" type="date" placeholder="구분" style="width:200px; height:20px"></p>
        <p>&nbsp;&nbsp;금액&nbsp;&nbsp;&nbsp;&nbsp;: <input name="money" type="text" placeholder="구분" style="width:200px; height:20px"></p>
        <p>종목&nbsp;&nbsp;&nbsp;&nbsp;: <input name="content" type="text" placeholder="구분" style="width:200px; height:20px"></p>
        <p>거래처&nbsp;&nbsp;: <input name="target" type="text" placeholder="구분" style="width:200px; height:20px"></p>
        <p>&nbsp;실적&nbsp;&nbsp;&nbsp;&nbsp;: <input name="result" type="text" placeholder="구분" style="width:200px; height:20px"></p>
        <p>상세내용 : <input name="contents" type="text" placeholder="구분" style="width:80%; height:200px"></p>
        <input  id= "store" type="submit"  style="width: 60px; height:30px" >
        <input name="취소" id="cancel" type="button" value="취소" style="width: 60px; height : 30px">
-->
        <ul><li>구분:<input name="no" type="radio" value="입금" placeholder="구분" style="width:10%; height:20px">입금
        <input name="no" type="radio" value="출금" placeholder="구분" style="width:10%; height:20px">출금</li>
        <li>발생기간: <input name="time" type="date" placeholder="구분" style="width:40%; height:20px"></li></ul>
        <ul><li>금액&nbsp;&nbsp;&nbsp;: <input name="money" type="text" placeholder="구분" style="width:50%; height:20px"></li>
        <li>종목: <input name="content" type="text" placeholder="구분" style="width:50%; height:20px"></li></ul>
        <ul><li>거래처: <input name="target" type="text" placeholder="구분" style="width:50%; height:20px"></li>
        <li>실적: <input name="result" type="text" placeholder="구분" style="width:50%; height:20px"></li></ul>
        <p>상세내용 : <input name="contents" type="text" placeholder="구분" style="width:calc(80%); height:200px"></p>
        <ul class="i2"><input  id= "store" type="submit"  style="width: 60px; height:30px" >
        <input name="취소" id="cancel" type="button" value="취소" style="width: 60px; height : 30px"><ul>

      </form>
    </div>
  </section>
  <section id="c3">
    <div class="s1">
    <form action="index.html#c1">
    날짜 범위 <input name="date" type="date" style="width: 200px; height:30px">
    <input name="date" type="date" style="width: 200px; height:30px">
    <input type="button" value="검색" style="width: 100px; height:30px">
    </form>
    </div>
    <table>
      <thead>
      <tr>
        <th>구분</th>
        <th>발생기간</th>
        <th>금액</th>
        <th>실적</th>
      </tr>
      <tbody>
        <td>입금</td>
        <td>2019년07월</td>
        <td>100000</td>
        <td>110000</td>
      </tbody>
    </thead>
    </table>
  </section>
</body>
</html>
